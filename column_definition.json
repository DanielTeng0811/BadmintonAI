{
  "metadata": {
    "description": "羽球比賽數據欄位定義",
    "structure": "三戰兩勝制, 21分制。⚠️ 每局決勝分未記錄，每個set的最後一球誰得分，他的分數需+1。"
  },
  "shot_types": {
    "1": "發短球",
    "2": "發長球",
    "3": "長球",
    "4": "殺球",
    "5": "切球",
    "6": "挑球",
    "7": "平球",
    "8": "網前球",
    "9": "推撲球",
    "10": "接殺防守",
    "11": "接不到"
  },
  "data_columns": [
    {
      "column": "match_id",
      "description": "比賽 ID。用來區分不同的比賽場次。"
    },
    {
      "column": "set",
      "description": "局數。每場刷新。",
      "value_range": "1-3"
    },
    {
      "column": "rally",
      "description": "從發球開始到死球結束稱為一個 Rally。這是該局的第幾個 Rally。每局刷新。",
      "usage": "跨局需配match_id, set。總回合: df.groupby(['match_id', 'set', 'rally']).ngroups"
    },
    {
      "column": "rally_id",
      "description": "整個數據集中唯一的回合 ID"
    },
    {
      "column": "ball_round",
      "description": "這是一個 Rally 中的第幾拍。發球是第 1 拍，接發球是第 2 拍，以此類推。",
      "usage": "若要觀察對手回球、輸球原因等，可使用df['其他特定欄位'].shift()獲取前後拍的資訊"
    },
    {
      "column": "player_score",
      "description": "'Kento MOMOTA'的當前局內分數。每局刷新。",
      "warning": "非字面意思的player分數"
    },
    {
      "column": "opponent_score",
      "description": "'CHOU Tien Chen'的當前局內分數。每局刷新。",
      "warning": "非字面意思的opponent分數"
    },
    {
      "column": "score_status",
      "description": "分數差距 (player score(Kento MOMOTA) - opponent score(CHOU Tien Chen)",
      "note": "score_status>3表示CHOU Tien Chen落後3分以上，score_status<-3表示CHOU Tien Chen領先3分以上"
    },
    {
      "column": "player",
      "description": "擊球球員姓名",
      "note": "每個rally中雙方交替擊球",
      "usage": "與多數欄位同時使用，代表player的各種情況。例如:(df['player']=='Player A' & df['type']=='殺球') -> Player A的殺球"
    },
    {
      "column": "opponent",
      "description": "對手球員姓名",
      "note": "每個rally中雙方交替擊球"
    },
    {
      "column": "server",
      "description": "發球狀態",
      "mapping": "1:player發球, 2:對打中"
    },
    {
      "column": "type",
      "description": "該球player打出的球種名稱(中文)",
      "note": "參照shot_types。發球球種:發短球/發長球；其他皆是打擊球種，依題目篩選兩者",
      "usage": "可使用df['type'].shift()獲取前後拍的球種"
    },
    {
      "column": "player_type",
      "description": "該球player打出的球種代碼，等價於df['opponent_type'].shift(-1)。與type欄位對應，用df['type']為佳",
      "data_type": "float",
      "mapping": "1-11 (見shot_types)",
      "usage": "若需要對手如何回擊player，參考下一筆的player_type，但必須確保在同個rally中"
    },
    {
      "column": "opponent_type",
      "description": "opponent前一球打出的球種代碼，等價於df['player_type'].shift(1)。與df['type'].shift(1)欄位對應，用df['type'].shift(1)為佳",
      "mapping": "1-11 (見shot_types)，或0(未意義:出現在rally第一球與最後一球)",
      "note": "不等價於opponent的回擊球種代碼"
    },
    {
      "column": "hit_x",
      "description": "player擊球點X座標"
    },
    {
      "column": "hit_y",
      "description": "player擊球點Y座標"
    },
    {
      "column": "hit_area",
      "description": "player擊球點所在區域代碼 (1-32)，等價於df['landing_area'].shift(1)"
    },
    {
      "column": "landing_x",
      "description": "球的落點X座標，可視為下顆球對方的擊球點X座標"
    },
    {
      "column": "landing_y",
      "description": "球的落點Y座標，可視為下顆球對方的擊球點Y座標"
    },
    {
      "column": "landing_area",
      "description": "球的落點區域代碼 (1-32)(即為下顆球對方的擊球點區域代碼)，等價於df['hit_area'].shift(-1)"
    },
    {
      "column": "player_location_x",
      "description": "球員所站點的 X 座標。"
    },
    {
      "column": "player_location_y",
      "description": "球員所站點的 Y 座標。"
    },
    {
      "column": "player_location_area",
      "description": "當前打擊者所站點的區域代碼，df['player_location_area'] == df.groupby(['match_id', 'set', 'rally'])['opponent_location_area'].shift(1)"
    },
    {
      "column": "player_move_x",
      "description": "擊球點到移動位置的X座標位移量。(moving_x-hit_x)"
    },
    {
      "column": "player_move_y",
      "description": "擊球點到移動位置的Y座標位移量。(moving_y-hit_y)"
    },
    {
      "column": "moving_x",
      "description": "球員擊完這一球後，移動到的X座標。"
    },
    {
      "column": "moving_y",
      "description": "球員擊完這一球後，移動到的Y座標。"
    },
    {
      "column": "player_moving_area",
      "description": "球員擊完這一球後，移動到的區域代碼",
      "keyword": "回位"
    },
    {
      "column": "opponent_location_x",
      "description": "對手所站的位置X座標"
    },
    {
      "column": "opponent_location_y",
      "description": "對手所站的位置Y座標"
    },
    {
      "column": "opponent_location_area",
      "description": "當前對手所站的位置區域代碼，等價於df['opponent_location_area'] == df.groupby(['match_id', 'set', 'rally'])['player_location_area'].shift(-1)"
    },
    {
      "column": "opponent_move_x",
      "description": "對手擊球點到移動位置的X座標位移量。"
    },
    {
      "column": "opponent_move_y",
      "description": "對手擊球點到移動位置的Y座標位移量。"
    },
    {
      "column": "ball_distance",
      "description": "飛行距離。球從擊球點 (hit) 到落點 (landing) 的直線距離。"
    },
    {
      "column": "getpoint_player",
      "description": "該回合得分者，若正在打球過程",
      "usage": "group by set/rally取last()，同時欄位有NULL存在，必要時可使用dropna()",
      "note": "此欄位有三種狀況: player主動得分、player主動失分(當opponent == getpoint_player)與player未得分也未失分(當getpoint_ player==NULL)。",
      "IMPORTANT": "getpoint_player != CHOU Tien Chen不代表周天成失分，getpoint_player == Kento MOMOTA代表周天成失分(正確邏輯)，up 因為getpoint_player可能為NULL。"
    },
    {
      "column": "win_reason",
      "description": "player得分原因，其他為NULL無意義不代表任何得失分",
      "note": "搭配ball_round查詢前後拍(e.x.回擊、造成原因)對手得分原因等"
    },
    {
      "column": "lose_reason",
      "description": "player失分原因，其他為NULL無意義不代表任何得失分",
      "note": "搭配ball_round查詢前後拍(e.x.回擊、造成原因)對手失分原因等",
      "usage": "(relevant_df['player'] == 'Player_A') & (relevant_df['lose_reason'] == '未過網') -> Player_A自己失分原因為未過網的情況"
    },
    {
      "column": "aroundhead",
      "description": "是否為繞頭擊球 (1: 是, 0: 否)"
    },
    {
      "column": "backhand",
      "description": "是否為反手拍 (1: 是, 0: 否)"
    },
    {
      "column": "hit_height",
      "description": "擊球時的高度"
    },
    {
      "column": "landing_height",
      "description": "被接球時的高度"
    },
    {
      "column": "landing_court_number",
      "description": "落點所在的場地編號"
    },
    {
      "column": "ball_distance_x",
      "description": "球飛行路徑的 X 軸分量距離"
    },
    {
      "column": "ball_distance_y",
      "description": "球飛行路徑的 Y 軸分量距離"
    }
  ],
  "analysis_guidelines": {
    "core": "使用 getpoint_player (Event) 統計得分，勿用 player_score (State) 加總。",
    "rally_count": "df.groupby(['match_id', 'set', 'rally']).ngroups",
    "winning_logic": {
      "active": "球員(P1)擊球得分: df[(df['getpoint_player'] == 'P1') & (df['player'] == 'P1')]",
      "passive": "球員(P1)對手失誤: df[(df['getpoint_player'] == 'P1') & (df['player'] != 'P1')]"
    },
    "win_rate": "1.GroupBy ['match_id', 'set', 'rally']取 getpoint_player 2.選手贏得的回合數 / getpoint_player非空的總回合數",
    "shot_analysis": {
      "group": "用 player_type (數字代碼)",
      "logic": "分析「特定球種得分」時，必須篩選 player == getpoint_player (Active Win)。"
    },
    "match_score": "找出每局最後一筆分數，贏家+1。",
    "continuous_play": "回球查詢應用: iloc + `index + 1`，注意對手回球是在下一列。"
  }
}