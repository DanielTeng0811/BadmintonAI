{
  "metadata": {
    "description": "羽球比賽數據欄位定義",
    "structure": "三戰兩勝制, 21分制。⚠️ 每局決勝分未記錄，贏家分數需+1。"
  },
  "shot_types": {
    "1": "發短球",
    "2": "發長球",
    "3": "長球",
    "4": "殺球",
    "5": "切球",
    "6": "挑球",
    "7": "平球",
    "8": "網前球",
    "9": "推撲球",
    "10": "接殺防守",
    "11": "接不到"
  },
  "data_columns": [
    {
      "column": "match_id",
      "description": "比賽 ID。用來區分不同的比賽場次。"
    },
    {
      "column": "set",
      "description": "局數。每場刷新。",
      "value_range": "1-3"
    },
    {
      "column": "rally",
      "description": "從發球開始到死球結束稱為一個 Rally。這是該局的第幾個 Rally。每局刷新。",
      "usage": "跨局需配match_id, set。總回合: df.groupby(['match_id', 'set', 'rally']).ngroups"
    },
    {
      "column": "rally_id",
      "description": "整個數據集中唯一的回合 ID"
    },
    {
      "column": "ball_round",
      "description": "這是一個 Rally 中的第幾拍。發球是第 1 拍，接發球是第 2 拍，以此類推。"
    },
    {
      "column": "player_score",
      "description": "Kento MOMOTA的當前局內分數。每局刷新。",
      "warning": "❌ DO NOT SUM/MAX. Use `getpoint_player` counts."
    },
    {
      "column": "opponent_score",
      "description": "CHOU Tien Chen的當前局內分數。每局刷新。",
      "warning": "❌ DO NOT SUM/MAX. Use `getpoint_player` counts."
    },
    {
      "column": "score_status",
      "description": "分數差距 (player score - opponent score)",
      "note": "正=領先, 負=落後"
    },
    {
      "column": "player",
      "description": "擊球球員姓名",
      "note": "每個rally雙方交替擊球"
    },
    {
      "column": "opponent",
      "description": "對手球員姓名",
      "note": "每個rally雙方交替擊球"
    },
    {
      "column": "server",
      "description": "發球狀態",
      "mapping": "1:player發球, 2:對打中, 3:該回合結束"
    },
    {
      "column": "type",
      "description": "球種名稱(中文)",
      "note": "參照shot_types",
      "usage": "可使用df['type'].shift()獲取前後拍的球種"
    },
    {
      "column": "player_type",
      "description": "球員擊球球種代碼",
      "data_type": "float",
      "mapping": "1-11 (見shot_types)",
      "usage": "若需要對手如何回擊player，參考下一筆的player_type，但必須確保在同個rally中"
    },
    {
      "column": "opponent_type",
      "description": "對手上一拍球種代碼",
      "mapping": "1-11 (見shot_types)",
      "note": "等價於該rally前一筆的player_type"
    },
    {
      "column": "hit_x",
      "description": "擊球點X座標"
    },
    {
      "column": "hit_y",
      "description": "擊球點Y座標"
    },
    {
      "column": "hit_area",
      "description": "擊球點所在區域代碼 (1-32)"
    },
    {
      "column": "landing_x",
      "description": "球的落點X座標，可視為下顆球對方的擊球點X座標"
    },
    {
      "column": "landing_y",
      "description": "球的落點Y座標，可視為下顆球對方的擊球點Y座標"
    },
    {
      "column": "landing_area",
      "description": "球的落點區域代碼 (1-32)(即為下顆球對方的擊球點區域代碼)"
    },
    {
      "column": "player_location_x",
      "description": "球員所站點的 X 座標。"
    },
    {
      "column": "player_location_y",
      "description": "球員所站點的 Y 座標。"
    },
    {
      "column": "player_location_area",
      "description": "球員所站點的區域代碼。"
    },
    {
      "column": "player_move_x",
      "description": "擊球點到移動位置的X座標位移量。(moving_x-hit_x)"
    },
    {
      "column": "player_move_y",
      "description": "擊球點到移動位置的Y座標位移量。(moving_y-hit_y)"
    },
    {
      "column": "moving_x",
      "description": "球員擊完這一球後，移動到的X座標。"
    },
    {
      "column": "moving_y",
      "description": "球員擊完這一球後，移動到的Y座標。"
    },
    {
      "column": "player_moving_area",
      "description": "球員擊完這一球後，移動到的區域代碼",
      "keyword": "回位"
    },
    {
      "column": "opponent_location_x",
      "description": "對手所站的位置X座標"
    },
    {
      "column": "opponent_location_y",
      "description": "對手所站的位置Y座標"
    },
    {
      "column": "opponent_location_area",
      "description": "對手擊球區域。對手所站的位置區域代碼"
    },
    {
      "column": "opponent_move_x",
      "description": "對手擊球點到移動位置的X座標位移量。"
    },
    {
      "column": "opponent_move_y",
      "description": "對手擊球點到移動位置的Y座標位移量。"
    },
    {
      "column": "ball_distance",
      "description": "飛行距離。球從擊球點 (hit) 到落點 (landing) 的直線距離。"
    },
    {
      "column": "getpoint_player",
      "description": "該回合得分者，若正在打球過程",
      "scope": "IMPORTANT:若值為NULL不代表任何得失分",
      "usage": "group by set/rally取last()，同時欄位有NULL存在，必要時可使用dropna()",
      "IMPORTANT": "此欄位有三種狀況: player主動得分、player主動失分(當opponent == getpoint_player)與player未得分也未失分(當getpoint_ player==NULL)。"
    },
    {
      "column": "win_reason",
      "description": "該球若player得分，則win_reason為得分原因，其他為NULL不代表任何得失分",
      "condition": "getpoint_player & win_reason both not null"
    },
    {
      "column": "lose_reason",
      "description": "該球若opponent得分，則lose_reason為失分原因，其他為NULL不代表任何得失分",
      "note": "記錄的是player失誤原因"
    }
  ],
  "analysis_guidelines": {
    "core": "使用 `getpoint_player` (Event) 統計得分，勿用 `player_score` (State) 加總。",
    "rally_count": "df.groupby(['match_id', 'set', 'rally']).ngroups",
    "winning_logic": {
      "active": "球員(P1)擊球得分: `df[(df['getpoint_player'] == 'P1') & (df['player'] == 'P1')]`",
      "passive": "球員(P1)對手失誤: `df[(df['getpoint_player'] == 'P1') & (df['player'] != 'P1')]`"
    },
    "win_rate": "1.GroupBy Rally取 getpoint_player 2.Sum Wins 3.Divide by total rallies",
    "shot_analysis": {
      "group": "用 `player_type` (數字代碼)",
      "logic": "分析「特定球種得分」時，必須篩選 `player == getpoint_player` (Active Win)。"
    },
    "match_score": "找出每局最後一筆分數，贏家+1。",
    "continuous_play": "回球查詢應用: `iloc` + `index + 1`，注意對手回球是在下一列。"
  }
}