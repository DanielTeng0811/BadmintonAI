{
  "metadata": {
    "description": "羽球比賽數據欄位定義",
    "match_structure": {
      "format": "三戰兩勝制",
      "set_scoring": "21分制"
    },
    "data_recording_note": "⚠️ 資料特性：每局最後一分（決勝分）未記錄。查詢比分時，贏家分數需+1。"
  },
  "shot_types": {
    "1": {
      "name": "發短球"
    },
    "2": {
      "name": "發長球"
    },
    "3": {
      "name": "長球"
    },
    "4": {
      "name": "殺球"
    },
    "5": {
      "name": "切球"
    },
    "6": {
      "name": "挑球"
    },
    "7": {
      "name": "平球"
    },
    "8": {
      "name": "網前球"
    },
    "9": {
      "name": "推撲球"
    },
    "10": {
      "name": "接殺防守"
    },
    "11": {
      "name": "接不到"
    }
  },
  "data_columns": [
    {
      "column": "match_id",
      "description": "比賽 ID。用來區分不同的比賽場次。",
      "keyword": "場次"
    },
    {
      "column": "set",
      "description": "局數",
      "value_range": "1-3"
    },
    {
      "column": "rally",
      "description": "從發球開始到死球結束稱為一個 Rally。這是該局的第幾個 Rally。",
      "scope": "局內",
      "important_note": "跨局分析需配 match_id, set",
      "correct_usage": "總回合: df.groupby(['match_id', 'set', 'rally']).ngroups"
    },
    {
      "column": "rally_id",
      "description": "整個數據集中唯一的回合 ID"
    },
    {
      "column": "ball_round",
      "description": "這是一個 Rally 中的第幾拍。發球是第 1 拍，接發球是第 2 拍，以此類推。",
      "usage": "回合中拍與拍的比較或回球數"
    },
    {
      "column": "player_score",
      "description": "該match的第一個發球者，他的得分",
      "value_range": "0-35",
      "usage": "df[df['match_id'] == 'match_id'].iloc[0]['player']，可對應到df[df['match_id'] == 'match_id']['player_score']是誰的得分"
    },
    {
      "column": "opponent_score",
      "description": "該match的第一個發球者，他的對手得分",
      "value_range": "0-35",
      "usage": "df[df['match_id'] == 'match_id'].iloc[1]['player']，可對應到df[df['match_id'] == 'match_id']['opponent_score']是誰的得分"
    },
    {
      "column": "score_status",
      "description": "分數差距 (player score - opponent score)",
      "value_range": "正=領先, 負=落後"
    },
    {
      "column": "player",
      "description": "擊球球員姓名",
      "important_note": "每個rally雙方球員會交替擊球(例如:這球player='A球員'，下一個球就是player='B球員')"
    },
    {
      "column": "server",
      "description": "發球狀態",
      "value_mapping": {
        "1": "player發球",
        "2": "對打中",
        "3": "該回合結束"
      }
    },
    {
      "column": "type",
      "description": "球種名稱(中文)",
      "value_range": [
        "殺球",
        "切球",
        "...參照shot_types"
      ]
    },
    {
      "column": "player_type",
      "description": "球員擊球球種代碼",
      "data_type": "float",
      "value_mapping": "1-11 (見shot_types)",
      "usage": "適合分組統計球種",
      "correct_usage": "df[df['player_type']==4].groupby('player').size()",
      "note": "使用type更佳"
    },
    {
      "column": "opponent_type",
      "description": "對手上一拍球種代碼",
      "value_mapping": "1-11 (見shot_types)"
    },
    {
      "column": "hit_x",
      "description": "擊球點X座標"
    },
    {
      "column": "hit_y",
      "description": "擊球點Y座標"
    },
    {
      "column": "hit_area",
      "description": "擊球點所在區域代碼 (1-32)",
      "keyword": "球員擊球點"
    },
    {
      "column": "landing_x",
      "description": "球的落點X座標，可視為下顆球對方的擊球點X座標"
    },
    {
      "column": "landing_y",
      "description": "球的落點Y座標，可視為下顆球對方的擊球點Y座標"
    },
    {
      "column": "landing_area",
      "description": "球的落點區域代碼 (1-32)(即為下顆球對方的擊球點區域代碼)",
      "keyword": "球的落點"
    },
    {
      "column": "player_location_x",
      "description": "球員所在的 X 座標。"
    },
    {
      "column": "player_location_y",
      "description": "球員所在的 Y 座標。"
    },
    {
      "column": "player_location_area",
      "description": "球員所在的站位區域。",
      "keyword": "球員站位"
    },
    {
      "column": "player_move_x",
      "description": "擊球點到移動位置的X座標位移量。(moving_x-hit_x)",
      "keyword": "球員移動量"
    },
    {
      "column": "player_move_y",
      "description": "擊球點到移動位置的Y座標位移量。(moving_y-hit_y)",
      "keyword": "球員移動量"
    },
    {
      "column": "moving_x",
      "description": "球員擊完這一球後，移動到的X座標。"
    },
    {
      "column": "moving_y",
      "description": "球員擊完這一球後，移動到的Y座標。"
    },
    {
      "column": "player_moving_area",
      "description": "球員擊完這一球後，移動到的區域代碼",
      "keyword": "回位"
    },
    {
      "column": "opponent_location_x",
      "description": "對手所站的位置X座標"
    },
    {
      "column": "opponent_location_y",
      "description": "對手所站的位置Y座標"
    },
    {
      "column": "opponent_location_area",
      "description": "對手擊球區域。對手所站的位置區域代碼",
      "keyword": "對手站位"
    },
    {
      "column": "opponent_move_x",
      "description": "對手擊球點到移動位置的X座標位移量。",
      "keyword": "對手移動量"
    },
    {
      "column": "opponent_move_y",
      "description": "對手擊球點到移動位置的Y座標位移量。",
      "keyword": "對手移動量"
    },
    {
      "column": "ball_distance",
      "description": "飛行距離。球從擊球點 (hit) 到落點 (landing) 的直線距離。",
      "keyword": "打擊的遠度"
    },
    {
      "column": "getpoint_player",
      "description": "該回合得分者",
      "scope": "僅在rally最後一拍(得失分拍)有值，其他設為NULL",
      "correct_usage": "groupby(['match_id', 'set', 'rally'])['getpoint_player'].last()"
    },
    {
      "column": "win_reason",
      "description": "該球若player得分，則win_reason為得分原因",
      "scope": "回合結束時(若player得分)有原因，其他設為NULL",
      "filter_condition": "getpoint_player.notna() & win_reason.notna()"
    },
    {
      "column": "lose_reason",
      "description": "該球若opponent得分，則lose_reason為失分原因，其他為NULL",
      "scope": "回合結束時(若opponent得分)有原因，其他設為NULL",
      "filter_condition": "getpoint_player.notna() & lose_reason.notna()",
      "important_note": "記錄的是player失誤原因"
    }
  ],
  "analysis_guidelines": {
    "rally_counting": {
      "issue": "rally編號每局重置",
      "correct": "df.groupby(['match_id', 'set', 'rally']).ngroups"
    },
    "win_rate_calculation": {
      "step1": "groupby(['match_id', 'set', 'rally'])['getpoint_player'].last()",
      "step2": "wins = (rally_winners == '球員').sum()",
      "step3": "win_rate = wins / len(rally_winners)"
    },
    "player_name_usage": {
      "rule": "須用完整姓名"
    },
    "shot_type_analysis": {
      "purpose": "球種統計",
      "correct": "用 player_type (數字) 分組",
      "note": "type=字串, player_type=代碼"
    },
    "match_score_query": {
      "context": "三戰兩勝, 21分制",
      "data_limitation": "最後一分沒記，贏家需+1",
      "correct": "找出每局最後一筆 player_score/opponent_score，贏家分數+1"
    },
    "continuous_shot_query": {
      "purpose": "連續對打紀錄",
      "example": "周天成使用殺球後，對手使用那些球種回擊",
      "correct_usage": "kento_smash = df[(df['player'] == 'CHOU Tien Chen') & (df['type'] == '殺球')  opponent_return_types = df['type'].iloc[kento_smash.index + 1].dropna()",
      "wrong_usage": "kento_smash = df[(df['player'] == 'CHOU Tien Chen') & (df['type'] == '殺球')  opponent_return_types = df['opponent_type'].iloc[kento_smash.index + 1].dropna()"
    }
  }
}